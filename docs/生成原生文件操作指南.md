# ç”Ÿæˆå„å¹³å°åŸç”Ÿæ–‡ä»¶æ“ä½œæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•å¦‚ä½•ä½¿ç”¨ Expo ç”Ÿæˆ iOS å’Œ Android å¹³å°çš„åŸç”Ÿæ–‡ä»¶ï¼ŒåŒ…æ‹¬ JavaScript Bundle æ–‡ä»¶ã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯åŸç”Ÿæ–‡ä»¶

åŸç”Ÿæ–‡ä»¶æ˜¯æŒ‡ï¼š
- **iOS**: `ios/` æ–‡ä»¶å¤¹ä¸­çš„ Xcode é¡¹ç›®æ–‡ä»¶ + `main.jsbundle`
- **Android**: `android/` æ–‡ä»¶å¤¹ä¸­çš„ Android Studio é¡¹ç›®æ–‡ä»¶ + `index.android.bundle`

è¿™äº›æ–‡ä»¶åŒ…å«ï¼š
- åŸç”Ÿä»£ç é…ç½®
- ä¾èµ–åº“é“¾æ¥
- æƒé™é…ç½®
- æ„å»ºè®¾ç½®
- **JavaScript Bundleï¼ˆé‡è¦ï¼ï¼‰**

## ğŸš€ å¿«é€Ÿå¼€å§‹ - ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

æˆ‘ä»¬æä¾›äº†ä¸‰ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥ç®€åŒ–æ•´ä¸ªè¿‡ç¨‹ï¼š

### 1. é‡æ–°ç”Ÿæˆ iOSï¼ˆæ¨èï¼‰â­

```bash
cd frontend
./rebuild-ios.sh
```

### 2. é‡æ–°ç”Ÿæˆ Android

```bash
cd frontend
./rebuild-android.sh
```

### 3. é‡æ–°ç”Ÿæˆæ‰€æœ‰å¹³å°

```bash
cd frontend
./rebuild-all.sh
```

è¿™äº›è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼ŒåŒ…æ‹¬ç”Ÿæˆ Bundle æ–‡ä»¶ï¼

---

## ğŸ”§ å‰ç½®è¦æ±‚

### é€šç”¨è¦æ±‚
```bash
# ç¡®ä¿å·²å®‰è£… Node.js (v18+)
node --version

# ç¡®ä¿å·²å®‰è£…é¡¹ç›®ä¾èµ–
cd frontend
npm install
```

### iOS è¦æ±‚
```bash
# ç¡®ä¿å·²å®‰è£… Xcode (v14+)
xcodebuild -version

# ç¡®ä¿å·²å®‰è£… CocoaPods
pod --version

# å¦‚æœæ²¡æœ‰å®‰è£… CocoaPods
sudo gem install cocoapods
```

### Android è¦æ±‚
```bash
# ç¡®ä¿å·²å®‰è£… Android Studio
# ç¡®ä¿å·²é…ç½® ANDROID_HOME ç¯å¢ƒå˜é‡
echo $ANDROID_HOME

# ç¡®ä¿å·²å®‰è£… Java JDK (v17+)
java --version
```

---

## ğŸ“± iOS åŸç”Ÿæ–‡ä»¶ç”Ÿæˆï¼ˆæ‰‹åŠ¨æ­¥éª¤ï¼‰

### å®Œæ•´æ­¥éª¤

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. åˆ é™¤ç°æœ‰çš„ iOS æ–‡ä»¶å¤¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
rm -rf ios

# 3. æ¸…é™¤ç¼“å­˜
rm -rf node_modules/.cache
rm -rf .expo

# 4. é‡æ–°ç”Ÿæˆ iOS åŸç”Ÿæ–‡ä»¶
npx expo prebuild --platform ios --clean

# 5. å®‰è£… CocoaPods ä¾èµ–
cd ios
pod install
cd ..

# 6. ç”Ÿæˆ JavaScript Bundleï¼ˆé‡è¦ï¼ï¼‰
npx react-native bundle \
    --entry-file index.js \
    --platform ios \
    --dev false \
    --bundle-output ios/main.jsbundle \
    --assets-dest ios

# 7. éªŒè¯æ–‡ä»¶
ls -lh ios/main.jsbundle

# 8. æ„å»ºå¹¶è¿è¡Œ
npx expo run:ios
```

### ä¸ºä»€ä¹ˆéœ€è¦ main.jsbundleï¼Ÿ

- **ç¦»çº¿è¿è¡Œ**: åº”ç”¨å¯ä»¥åœ¨æ²¡æœ‰ Metro Bundler çš„æƒ…å†µä¸‹è¿è¡Œ
- **ç”Ÿäº§æ„å»º**: æ‰“åŒ…å‘å¸ƒæ—¶å¿…éœ€
- **æ€§èƒ½ä¼˜åŒ–**: é¢„ç¼–è¯‘çš„ JavaScript ä»£ç åŠ è½½æ›´å¿«
- **Xcode æ„å»º**: æŸäº› Xcode æ„å»ºé…ç½®éœ€è¦è¿™ä¸ªæ–‡ä»¶

### iOS ç”Ÿæˆåçš„æ–‡ä»¶ç»“æ„

```
frontend/ios/
â”œâ”€â”€ AIVoiceNotes/                    # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ AppDelegate.swift           # åº”ç”¨å§”æ‰˜
â”‚   â”œâ”€â”€ Info.plist                  # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ Images.xcassets/            # å›¾æ ‡å’Œå¯åŠ¨å›¾
â”‚   â””â”€â”€ Supporting/                 # æ”¯æŒæ–‡ä»¶
â”œâ”€â”€ AIVoiceNotes.xcodeproj/         # Xcode é¡¹ç›®
â”œâ”€â”€ AIVoiceNotes.xcworkspace/       # Xcode å·¥ä½œç©ºé—´ï¼ˆä½¿ç”¨è¿™ä¸ªæ‰“å¼€ï¼‰
â”œâ”€â”€ Podfile                         # CocoaPods ä¾èµ–é…ç½®
â”œâ”€â”€ Podfile.lock                    # ä¾èµ–ç‰ˆæœ¬é”å®š
â”œâ”€â”€ Pods/                           # CocoaPods ä¾èµ–åº“
â”œâ”€â”€ main.jsbundle                   # â­ JavaScript Bundleï¼ˆé‡è¦ï¼ï¼‰
â””â”€â”€ assets/                         # èµ„æºæ–‡ä»¶
```

---

## ğŸ¤– Android åŸç”Ÿæ–‡ä»¶ç”Ÿæˆï¼ˆæ‰‹åŠ¨æ­¥éª¤ï¼‰

### å®Œæ•´æ­¥éª¤

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. åˆ é™¤ç°æœ‰çš„ Android æ–‡ä»¶å¤¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
rm -rf android

# 3. æ¸…é™¤ç¼“å­˜
rm -rf node_modules/.cache
rm -rf .expo

# 4. é‡æ–°ç”Ÿæˆ Android åŸç”Ÿæ–‡ä»¶
npx expo prebuild --platform android --clean

# 5. åˆ›å»º assets ç›®å½•
mkdir -p android/app/src/main/assets

# 6. ç”Ÿæˆ JavaScript Bundleï¼ˆé‡è¦ï¼ï¼‰
npx react-native bundle \
    --entry-file index.js \
    --platform android \
    --dev false \
    --bundle-output android/app/src/main/assets/index.android.bundle \
    --assets-dest android/app/src/main/res

# 7. éªŒè¯æ–‡ä»¶
ls -lh android/app/src/main/assets/index.android.bundle

# 8. æ„å»ºå¹¶è¿è¡Œ
npx expo run:android
```

### Android ç”Ÿæˆåçš„æ–‡ä»¶ç»“æ„

```
frontend/android/
â”œâ”€â”€ app/                            # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ main/
â”‚   â”‚       â”œâ”€â”€ AndroidManifest.xml # åº”ç”¨æ¸…å•
â”‚   â”‚       â”œâ”€â”€ java/               # Java/Kotlin ä»£ç 
â”‚   â”‚       â”œâ”€â”€ assets/
â”‚   â”‚       â”‚   â””â”€â”€ index.android.bundle  # â­ JavaScript Bundleï¼ˆé‡è¦ï¼ï¼‰
â”‚   â”‚       â””â”€â”€ res/                # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ build.gradle                # åº”ç”¨æ„å»ºé…ç½®
â”œâ”€â”€ gradle/                         # Gradle é…ç½®
â”œâ”€â”€ build.gradle                    # é¡¹ç›®æ„å»ºé…ç½®
â””â”€â”€ settings.gradle                 # é¡¹ç›®è®¾ç½®
```

---

## ğŸ”„ åŒæ—¶ç”Ÿæˆä¸¤ä¸ªå¹³å°

### ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd frontend
./rebuild-all.sh
```

### æ‰‹åŠ¨æ­¥éª¤

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. åˆ é™¤ç°æœ‰çš„åŸç”Ÿæ–‡ä»¶å¤¹
rm -rf ios android

# 3. æ¸…é™¤ç¼“å­˜
rm -rf node_modules/.cache
rm -rf .expo

# 4. åŒæ—¶ç”Ÿæˆ iOS å’Œ Android
npx expo prebuild --clean

# 5. iOS: å®‰è£… CocoaPods ä¾èµ–
cd ios
pod install
cd ..

# 6. iOS: ç”Ÿæˆ Bundle
npx react-native bundle \
    --entry-file index.js \
    --platform ios \
    --dev false \
    --bundle-output ios/main.jsbundle \
    --assets-dest ios

# 7. Android: åˆ›å»º assets ç›®å½•
mkdir -p android/app/src/main/assets

# 8. Android: ç”Ÿæˆ Bundle
npx react-native bundle \
    --entry-file index.js \
    --platform android \
    --dev false \
    --bundle-output android/app/src/main/assets/index.android.bundle \
    --assets-dest android/app/src/main/res

# 9. è¿è¡Œå¯¹åº”å¹³å°
npx expo run:ios
# æˆ–
npx expo run:android
```

---

## ğŸ“ è‡ªåŠ¨åŒ–è„šæœ¬è¯´æ˜

### rebuild-ios.sh

è‡ªåŠ¨å®Œæˆ iOS åŸç”Ÿæ–‡ä»¶ç”Ÿæˆçš„æ‰€æœ‰æ­¥éª¤ï¼š

1. âœ… æ£€æŸ¥å½“å‰ç›®å½•
2. âœ… æ¸…é™¤æ—§çš„ iOS æ–‡ä»¶
3. âœ… æ¸…é™¤ç¼“å­˜
4. âœ… ç”Ÿæˆ iOS åŸç”Ÿæ–‡ä»¶
5. âœ… å®‰è£… CocoaPods ä¾èµ–
6. âœ… ç”Ÿæˆ JavaScript Bundle
7. âœ… éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
8. âœ… æ˜¾ç¤ºä¸‹ä¸€æ­¥æ“ä½œ

### rebuild-android.sh

è‡ªåŠ¨å®Œæˆ Android åŸç”Ÿæ–‡ä»¶ç”Ÿæˆçš„æ‰€æœ‰æ­¥éª¤ï¼š

1. âœ… æ£€æŸ¥å½“å‰ç›®å½•
2. âœ… æ¸…é™¤æ—§çš„ Android æ–‡ä»¶
3. âœ… æ¸…é™¤ç¼“å­˜
4. âœ… ç”Ÿæˆ Android åŸç”Ÿæ–‡ä»¶
5. âœ… ç”Ÿæˆ JavaScript Bundle
6. âœ… éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
7. âœ… æ˜¾ç¤ºä¸‹ä¸€æ­¥æ“ä½œ

### rebuild-all.sh

åŒæ—¶å®Œæˆ iOS å’Œ Android çš„æ‰€æœ‰æ­¥éª¤ã€‚

---

## ğŸ¯ ä½•æ—¶éœ€è¦é‡æ–°ç”ŸæˆåŸç”Ÿæ–‡ä»¶

### å¿…é¡»é‡æ–°ç”Ÿæˆçš„æƒ…å†µ

1. **æ·»åŠ äº†æ–°çš„åŸç”Ÿæ¨¡å—**
   ```bash
   npm install expo-notifications
   cd frontend
   ./rebuild-ios.sh  # æˆ– ./rebuild-android.sh
   ```

2. **ä¿®æ”¹äº† app.json ä¸­çš„åŸç”Ÿé…ç½®**
   ```json
   {
     "expo": {
       "ios": {
         "bundleIdentifier": "com.newapp.id"
       }
     }
   }
   ```
   ```bash
   cd frontend
   ./rebuild-all.sh
   ```

3. **æ·»åŠ äº†æ–°çš„æƒé™**
   ```json
   {
     "expo": {
       "ios": {
         "infoPlist": {
           "NSCameraUsageDescription": "éœ€è¦ç›¸æœºæƒé™"
         }
       }
     }
   }
   ```
   ```bash
   cd frontend
   ./rebuild-ios.sh
   ```

4. **æ›´æ–°äº† Expo SDK ç‰ˆæœ¬**
   ```bash
   npm install expo@latest
   cd frontend
   ./rebuild-all.sh
   ```

5. **éœ€è¦ç”Ÿæˆç”Ÿäº§ç‰ˆæœ¬çš„ Bundle**
   ```bash
   cd frontend
   ./rebuild-ios.sh  # ä¼šç”Ÿæˆä¼˜åŒ–çš„ Bundle
   ```

### ä¸éœ€è¦é‡æ–°ç”Ÿæˆçš„æƒ…å†µ

1. **åªä¿®æ”¹äº† JavaScript/TypeScript ä»£ç **
   - ç›´æ¥è¿è¡Œå³å¯ï¼ŒMetro Bundler ä¼šè‡ªåŠ¨æ›´æ–°

2. **ä¿®æ”¹äº†æ ·å¼æˆ–å¸ƒå±€**
   - ä¸éœ€è¦é‡æ–°ç”Ÿæˆ

3. **æ·»åŠ äº†çº¯ JS çš„ç¬¬ä¸‰æ–¹åº“**
   ```bash
   npm install lodash
   # ä¸éœ€è¦ prebuild
   ```

---

## ğŸ” éªŒè¯ç”Ÿæˆç»“æœ

### iOS éªŒè¯

```bash
# 1. æ£€æŸ¥ iOS æ–‡ä»¶å¤¹
ls -la frontend/ios

# 2. æ£€æŸ¥ Bundle æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰
ls -lh frontend/ios/main.jsbundle
# åº”è¯¥æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆé€šå¸¸ 1-5 MBï¼‰

# 3. æ£€æŸ¥ CocoaPods
ls -la frontend/ios/Pods

# 4. æ£€æŸ¥ Xcode é¡¹ç›®
open frontend/ios/AIVoiceNotes.xcworkspace

# 5. å°è¯•æ„å»º
cd frontend
npx expo run:ios
```

### Android éªŒè¯

```bash
# 1. æ£€æŸ¥ Android æ–‡ä»¶å¤¹
ls -la frontend/android

# 2. æ£€æŸ¥ Bundle æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰
ls -lh frontend/android/app/src/main/assets/index.android.bundle
# åº”è¯¥æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆé€šå¸¸ 1-5 MBï¼‰

# 3. æ£€æŸ¥ Gradle é…ç½®
cat frontend/android/build.gradle

# 4. å°è¯•æ„å»º
cd frontend
npx expo run:android
```

---

## ğŸ› å¸¸è§é—®é¢˜

### iOS é—®é¢˜

#### é—®é¢˜ 1: main.jsbundle æ–‡ä»¶ä¸å­˜åœ¨

**åŸå› **: æ²¡æœ‰è¿è¡Œ bundle å‘½ä»¤

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd frontend
npx react-native bundle \
    --entry-file index.js \
    --platform ios \
    --dev false \
    --bundle-output ios/main.jsbundle \
    --assets-dest ios
```

#### é—®é¢˜ 2: CocoaPods å®‰è£…å¤±è´¥

```bash
# è§£å†³æ–¹æ¡ˆ 1: æ›´æ–° CocoaPods ä»“åº“
cd frontend/ios
pod repo update
pod install

# è§£å†³æ–¹æ¡ˆ 2: æ¸…é™¤ç¼“å­˜
pod cache clean --all
pod deintegrate
pod install

# è§£å†³æ–¹æ¡ˆ 3: ä½¿ç”¨ Rosettaï¼ˆApple Silicon Macï¼‰
arch -x86_64 pod install
```

#### é—®é¢˜ 3: Xcode æ„å»ºå¤±è´¥

```bash
# æ¸…é™¤ Xcode æ„å»ºç¼“å­˜
cd frontend/ios
rm -rf build
rm -rf ~/Library/Developer/Xcode/DerivedData

# é‡æ–°è¿è¡Œè„šæœ¬
cd ..
./rebuild-ios.sh
```

### Android é—®é¢˜

#### é—®é¢˜ 1: index.android.bundle æ–‡ä»¶ä¸å­˜åœ¨

**åŸå› **: æ²¡æœ‰è¿è¡Œ bundle å‘½ä»¤

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd frontend
mkdir -p android/app/src/main/assets
npx react-native bundle \
    --entry-file index.js \
    --platform android \
    --dev false \
    --bundle-output android/app/src/main/assets/index.android.bundle \
    --assets-dest android/app/src/main/res
```

#### é—®é¢˜ 2: Gradle åŒæ­¥å¤±è´¥

```bash
# æ¸…é™¤ Gradle ç¼“å­˜
cd frontend/android
./gradlew clean

# æˆ–åˆ é™¤ Gradle ç¼“å­˜
rm -rf ~/.gradle/caches
cd ..
./rebuild-android.sh
```

---

## ğŸš¨ é‡è¦æ³¨æ„äº‹é¡¹

### 1. Bundle æ–‡ä»¶æ˜¯å¿…éœ€çš„

- **å¼€å‘æ¨¡å¼**: å¯ä»¥ä¸éœ€è¦ï¼ˆä½¿ç”¨ Metro Bundlerï¼‰
- **ç”Ÿäº§æ„å»º**: å¿…é¡»æœ‰ Bundle æ–‡ä»¶
- **Xcode Archive**: å¿…é¡»æœ‰ main.jsbundle
- **Android Release**: å¿…é¡»æœ‰ index.android.bundle

### 2. ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ç”Ÿæˆçš„æ–‡ä»¶

- åŸç”Ÿæ–‡ä»¶ç”± Expo è‡ªåŠ¨ç”Ÿæˆ
- æ‰‹åŠ¨ä¿®æ”¹ä¼šåœ¨ä¸‹æ¬¡ prebuild æ—¶ä¸¢å¤±
- æ‰€æœ‰é…ç½®åº”è¯¥åœ¨ `app.json` ä¸­å®Œæˆ

### 3. ç‰ˆæœ¬æ§åˆ¶

```bash
# .gitignore åº”è¯¥åŒ…å«
ios/
android/
```

- åŸç”Ÿæ–‡ä»¶ä¸åº”è¯¥æäº¤åˆ° Git
- æ¯ä¸ªå¼€å‘è€…è‡ªå·±ç”Ÿæˆ
- Bundle æ–‡ä»¶ä¹Ÿä¸æäº¤

### 4. ä½¿ç”¨è„šæœ¬

- âœ… æ¨èä½¿ç”¨æä¾›çš„è‡ªåŠ¨åŒ–è„šæœ¬
- âœ… è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆ Bundle æ–‡ä»¶
- âœ… è„šæœ¬ä¼šéªŒè¯æ‰€æœ‰å¿…éœ€æ–‡ä»¶
- âœ… è„šæœ¬ä¼šæ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ“Š è„šæœ¬æ‰§è¡Œæµç¨‹å›¾

```
å¼€å§‹
  â†“
æ£€æŸ¥å½“å‰ç›®å½•
  â†“
åˆ é™¤æ—§çš„åŸç”Ÿæ–‡ä»¶å¤¹
  â†“
æ¸…é™¤ç¼“å­˜
  â†“
è¿è¡Œ npx expo prebuild
  â†“
iOS: è¿è¡Œ pod install
  â†“
ç”Ÿæˆ JavaScript Bundle â­
  â†“
éªŒè¯æ‰€æœ‰æ–‡ä»¶
  â†“
æ˜¾ç¤ºä¸‹ä¸€æ­¥æ“ä½œ
  â†“
å®Œæˆ
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹è„šæœ¬å¸®åŠ©

```bash
# æŸ¥çœ‹è„šæœ¬å†…å®¹
cat frontend/rebuild-ios.sh
cat frontend/rebuild-android.sh
cat frontend/rebuild-all.sh
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# iOS è¯¦ç»†æ—¥å¿—
npx expo run:ios --verbose

# Android è¯¦ç»†æ—¥å¿—
npx expo run:android --verbose
```

### æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼ˆç»ˆææ–¹æ¡ˆï¼‰

```bash
cd frontend

# æ¸…é™¤ npm ç¼“å­˜
rm -rf node_modules
rm -rf node_modules/.cache
npm cache clean --force

# æ¸…é™¤åŸç”Ÿæ–‡ä»¶
rm -rf ios
rm -rf android

# æ¸…é™¤ Expo ç¼“å­˜
rm -rf .expo

# é‡æ–°å®‰è£…
npm install

# é‡æ–°ç”Ÿæˆ
./rebuild-all.sh
```

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# iOS å®Œæ•´é‡æ–°ç”Ÿæˆ
cd frontend && ./rebuild-ios.sh

# Android å®Œæ•´é‡æ–°ç”Ÿæˆ
cd frontend && ./rebuild-android.sh

# æ‰€æœ‰å¹³å°å®Œæ•´é‡æ–°ç”Ÿæˆ
cd frontend && ./rebuild-all.sh

# åªç”Ÿæˆ Bundleï¼ˆiOSï¼‰
npx react-native bundle --entry-file index.js --platform ios --dev false --bundle-output ios/main.jsbundle --assets-dest ios

# åªç”Ÿæˆ Bundleï¼ˆAndroidï¼‰
npx react-native bundle --entry-file index.js --platform android --dev false --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res

# è¿è¡Œåº”ç”¨
npx expo run:ios
npx expo run:android
```

---

**æœ€åæ›´æ–°**: 2026-01-21  
**Expo SDK ç‰ˆæœ¬**: 53.0.0  
**åŒ…å« Bundle ç”Ÿæˆ**: âœ… æ˜¯
